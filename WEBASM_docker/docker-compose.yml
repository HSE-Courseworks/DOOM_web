version: "3"

# Раздел, в котором будут описаны сервисы, начинается с 'services'.
services: 

  # Для именования соответствующего сервиса, используем ключевое слово 'server'.
  server: 
 
    # Ключевое слово "build" позволяет задать путь к файлу Dockerfile, который нужно использовать для создания образа, который позволит запустить сервис.
    # Здесь 'server/' соответствует пути к папке сервера, которая содержит соответствующий Dockerfile.
    build: server/

    # Команда, которую нужно запустить после создания образа. Следующая команда означает запуск "python ./server.py".
    command: python ./server.py

    # Организовать перенаправление портов нам поможет ключевое слово 'ports'.
    # В нашем случае нужно использовать порт компьютера 1234 и организовать его связь с портом 1234 контейнера.
    ports:
      - 1234:1234

  # Второй сервис (контейнер): клиент. Этот сервис назван 'client'.
  client:

    # Здесь 'client/ соответствует пути к папке, которая содержит файл Dockerfile для клиентской части системы.
    build: client/

    # Команда, которую нужно запустить после создания образа. Следующая команда означает запуск "python ./client.py".
    command: python ./client.py

    # Ключевое слово 'network_mode' используется для описания типа сети. Тут мы указываем то, что контейнер может обращаться к 'localhost' компьютера.
    network_mode: host

    # Ключевое слово 'depends_on' позволяет указывать, должен ли сервис, прежде чем запуститься, ждать, когда будут готовы к работе другие сервисы.
    # Нам нужно, чтобы сервис 'client' дождался бы готовности к работе сервиса 'server'.
    depends_on:
      - server